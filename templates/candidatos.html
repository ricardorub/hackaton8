{% extends "layout.html" %}

{% block content %}
<div class="container mt-4">
    <div class="text-center mb-5">
        <h1 class="display-4">Conoce a los Candidatos</h1>
        <p class="lead text-muted">Toda la información que necesitas para tomar una decisión informada.</p>
    </div>

    <div id="lista-candidatos" class="row gy-4">
        <!-- Las tarjetas de candidatos se insertarán aquí dinámicamente -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const listaCandidatos = document.getElementById("lista-candidatos");

    async function cargarCandidatos() {
        try {
            const response = await fetch("/api/candidatos");
            if (!response.ok) {
                throw new Error(`Error: ${response.statusText}`);
            }
            const candidatos = await response.json();

            if (candidatos.length === 0) {
                listaCandidatos.innerHTML = `<div class="col-12"><p class="text-center">No hay candidatos para mostrar.</p></div>`;
                return;
            }

            candidatos.forEach(candidato => {
                const card = document.createElement("div");
                card.className = "col-lg-6";

                const placeholderImg = 'https://via.placeholder.com/150';
                const imagenSrc = candidato.imagen_base64 ? `data:image/jpeg;base64,${candidato.imagen_base64}` : placeholderImg;
                const logoSrc = candidato.partido.logo_base64 ? `data:image/png;base64,${candidato.partido.logo_base64}` : placeholderImg;

                card.innerHTML = `
                    <div class="card shadow-sm h-100">
                        <div class="row g-0">
                            <div class="col-md-4 text-center p-3">
                                <img src="${imagenSrc}" class="img-fluid rounded-circle" alt="Foto de ${candidato.nombre_completo}" style="width: 150px; height: 150px; object-fit: cover;">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h4 class="card-title">${candidato.nombre_completo}</h4>
                                    <h6 class="card-subtitle mb-2 text-muted">${candidato.tipo_candidatura} - ${candidato.region}</h6>
                                    <a href="${candidato.perfil_url}" class="btn btn-sm btn-outline-primary" target="_blank">Ver Perfil Detallado</a>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-light">
                            <div class="d-flex align-items-center">
                                <img src="${logoSrc}" alt="Logo de ${candidato.partido.nombre}" class="me-3" style="width: 50px; height: 50px;">
                                <div>
                                    <h6 class="mb-0">${candidato.partido.nombre} (${candidato.partido.siglas})</h6>
                                    <small class="text-muted"><strong>Personero:</strong> ${candidato.partido.personero_titular || 'No disponible'}</small><br>
                                    <small class="text-muted"><strong>Dirección:</strong> ${candidato.partido.direccion_legal || 'No disponible'}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                listaCandidatos.appendChild(card);
            });

        } catch (error) {
            console.error("Error al cargar candidatos:", error);
            listaCandidatos.innerHTML = `<div class="col-12 alert alert-danger">Error al cargar la información. Intente de nuevo más tarde.</div>`;
        }
    }

    cargarCandidatos();
});
</script>
{% endblock %}
