{% extends 'layout.html' %}

{% block content %}
<div class="header">
    <div class="container">
        <h1 class="display-5 fw-bold text-center">Calendario de Actividades de los Miembros de Mesa</h1>
        <p class="lead text-center mb-0">Sigue la l√≠nea de tiempo de las actividades durante la jornada electoral:</p>
    </div>
</div>

<div class="filter-section">
    <div class="container">
        <div class="year-tabs mb-3">
            <button class="year-tab active" data-year="horario">Horario</button>
            <button class="year-tab" data-year="instalacion">Instalaci√≥n</button>
            <button class="year-tab" data-year="sufragio">Sufragio</button>
            <button class="year-tab" data-year="otros">Otros</button>
        </div>
        <div class="month-tabs" id="monthTabs">
            <!-- Las pesta√±as se cargar√°n din√°micamente aqu√≠ -->
        </div>
    </div>
</div>

<div class="timeline-container" id="timelineContainer">
    <!-- Los eventos se cargar√°n din√°micamente aqu√≠ -->
</div>
{% endblock %}

{% block scripts %}
<script>
    const eventsData = {
        'horario': {
            'horario': [
                {
                    date: '6:00 a.m.',
                    title: 'Los miembros de mesa deben reunirse en el local de votaci√≥n asignado',
                    icon: '‚è∞'
                },
                {
                    date: '7:00 a.m.',
                    title: 'Se conforma e instala la mesa',
                    icon: 'üõ†Ô∏è',
                    items: [
                        'Se inicia la revisi√≥n del material electoral recibido'
                    ]
                },
                {
                    date: '8:00 a.m.',
                    title: 'Inicia oficialmente la jornada de sufragio',
                    icon: 'üó≥Ô∏è'
                },
                {
                    date: '5:00 p.m.',
                    title: 'Se cierran las puertas del local de votaci√≥n',
                    icon: 'üö™',
                    items: [
                        'Pueden votar quienes hayan ingresado antes de esta hora'
                    ]
                },
                {
                    date: 'Despu√©s de 5:00 p.m.',
                    title: 'Inicio del acto de escrutinio',
                    icon: 'üìä',
                    items: [
                        'Una vez concluido el sufragio, se inicia el acto de escrutinio'
                    ]
                },
                {
                    date: 'Finalizaci√≥n',
                    title: 'Conclusi√≥n del acto de escrutinio',
                    icon: '‚úÖ',
                    items: [
                        'El acto de escrutinio finaliza cuando se han contado todos los votos',
                        'Se completan todas las tareas finales'
                    ]
                }
            ]
        },
        'instalacion': {
            'instalacion': [
                {
                    date: 'Requisitos',
                    title: 'La instalaci√≥n de la mesa requiere',
                    icon: 'üë•',
                    items: [
                        'La presencia de al menos tres miembros de mesa titulares o suplentes'
                    ]
                },
                {
                    date: 'Recepci√≥n del material',
                    title: 'Extraer los materiales de los paquetes "A" y "B"',
                    icon: 'üì¶',
                    items: [
                        'Verificar que el contenido sea correcto seg√∫n las etiquetas'
                    ]
                },
                {
                    date: 'Firma de asistencia',
                    title: 'El secretario llama a cada miembro presente',
                    icon: '‚úçÔ∏è',
                    items: [
                        'Cada miembro firma y coloca su huella digital en la Hoja de Control de Asistencia',
                        'En caso de inasistencia, se escribe "FALT√ì"'
                    ]
                },
                {
                    date: 'Organizaci√≥n del espacio',
                    title: 'El tercer miembro guarda el paquete "C" (de escrutinio)',
                    icon: 'üì¶',
                    items: [
                        'Pega la etiqueta "Restos electorales" en la caja vac√≠a',
                        'Coloca la caja a un costado de la mesa'
                    ]
                },
                {
                    date: 'Verificaci√≥n del ambiente',
                    title: 'Todos los miembros verifican',
                    icon: 'üîç',
                    items: [
                        'Que la relaci√≥n de electores est√© pegada en el exterior del aula',
                        'Que el cartel de candidatos est√© dentro de la c√°mara secreta'
                    ]
                },
                {
                    date: 'Firma de c√©dulas',
                    title: 'El presidente verifica la cantidad de c√©dulas recibidas',
                    icon: 'üìù',
                    items: [
                        'Procede a firmar todas las c√©dulas'
                    ]
                },
                {
                    date: 'Llenado del Acta de Instalaci√≥n',
                    title: 'El secretario inicia el llenado del Acta Electoral',
                    icon: 'üìÑ',
                    items: [
                        'Completa la secci√≥n "A", Acta de Instalaci√≥n',
                        'Esta debe ser firmada por los tres miembros de mesa',
                        'Puede ser firmada por los personeros presentes si lo desean'
                    ]
                }
            ]
        },
        'sufragio': {
            'sufragio': [
                {
                    date: 'Identificaci√≥n del votante',
                    title: 'El presidente solicita el DNI del ciudadano',
                    icon: 'üÜî',
                    items: [
                        'Deposita el DNI en una bandeja',
                        'El secretario verifica el n√∫mero de orden, apellidos y nombres en la Lista de Electores'
                    ]
                },
                {
                    date: 'Entrega de c√©dula',
                    title: 'El presidente entrega una c√©dula doblada y firmada al elector',
                    icon: 'üó≥Ô∏è'
                },
                {
                    date: 'Votaci√≥n',
                    title: 'El tercer miembro verifica que el elector ingrese solo a la c√°mara secreta',
                    icon: 'üö∂'
                },
                {
                    date: 'Dep√≥sito del voto',
                    title: 'El tercer miembro indica al elector que coloque la c√©dula doblada en el √°nfora',
                    icon: 'üì•'
                },
                {
                    date: 'Registro del voto',
                    title: 'El secretario indica al elector d√≥nde debe firmar y poner su huella en la Lista de Electores',
                    icon: 'üìã'
                },
                {
                    date: 'Devoluci√≥n del DNI',
                    title: 'El presidente le pide al elector que recoja su DNI de la bandeja',
                    icon: 'üîÑ'
                },
                {
                    date: 'Al finalizar el sufragio',
                    title: 'Procedimiento de cierre',
                    icon: 'üîö',
                    items: [
                        'El presidente firma la √∫ltima p√°gina de la Lista de Electores',
                        'Se pregunta a los personeros si desean firmar',
                        'El secretario cuenta las firmas/huellas para determinar cu√°ntos ciudadanos votaron',
                        'Se anota esta cantidad en el Acta de Sufragio',
                        'Se marca con una "X" en el recuadro "NO VOT√ì" de cada persona que no acudi√≥',
                        'La lista se guarda en un sobre pl√°stico anaranjado',
                        'El sobre se entrega al personal de la ONPE'
                    ]
                }
            ]
        },
        'otros': {
            'otros': [
                {
                    date: 'Escrutinio',
                    title: 'Procedimiento de escrutinio',
                    icon: 'üìä',
                    items: [
                        'Tras el cierre de la votaci√≥n, se inicia el escrutinio simult√°neo de los votos para las elecciones Regional y Municipal',
                        'Los miembros de mesa verifican la validez de cada voto (v√°lido, nulo, en blanco)',
                        'Se registran los resultados en hojas borrador',
                        'Luego, se trasladan los totales al Acta de Escrutinio sin borrones ni enmendaduras'
                    ]
                },
                {
                    date: 'Protecci√≥n de resultados',
                    title: 'Una vez completadas las actas',
                    icon: 'üõ°Ô∏è',
                    items: [
                        'Se protegen los resultados y el campo de observaciones con l√°minas autoadhesivas'
                    ]
                },
                {
                    date: 'Entrega de actas',
                    title: 'El presidente entrega los sobres cerrados',
                    icon: 'üì®',
                    items: [
                        'Sobre morado, verde, plomo y anaranjado que contienen las actas',
                        'Se entregan a un responsable de la ONPE'
                    ]
                },
                {
                    date: 'Colocaci√≥n de resultados',
                    title: 'El tercer miembro pega los Carteles de Resultados',
                    icon: 'üìã',
                    items: [
                        'Se colocan en la entrada del aula de votaci√≥n'
                    ]
                },
                {
                    date: 'Devoluci√≥n de material',
                    title: 'Se devuelve todo el material electoral',
                    icon: 'üì¶',
                    items: [
                        '√Ånfora, cabinas, caja de restos electorales',
                        'Se entrega al personal de la ONPE'
                    ]
                },
                {
                    date: 'Impugnaciones',
                    title: 'Procedimiento para impugnaciones',
                    icon: '‚öñÔ∏è',
                    items: [
                        'Si un personero impugna un voto, los miembros de mesa resuelven por mayor√≠a',
                        'Si la impugnaci√≥n es fundada, el voto se cuenta como impugnado',
                        'El voto impugnado se guarda en un sobre especial junto con la c√©dula'
                    ]
                }
            ]
        }
    };

    const tabsData = {
        'horario': ['horario'],
        'instalacion': ['instalacion'],
        'sufragio': ['sufragio'],
        'otros': ['otros']
    };

    let currentYear = 'horario';
    let currentMonth = 'horario';

    function renderTimeline() {
        const container = document.getElementById('timelineContainer');
        const events = eventsData[currentYear][currentMonth];
        
        if (!events || events.length === 0) {
            container.innerHTML = '<div class="no-events">No hay informaci√≥n disponible para esta categor√≠a</div>';
            return;
        }

        container.innerHTML = events.map(event => `
            <div class="timeline-item">
                <span class="date-badge">${event.date}</span>
                <div class="timeline-content">
                    <div class="timeline-header">
                        <div class="icon-badge">${event.icon}</div>
                        <strong>${event.title}</strong>
                    </div>
                    ${event.items ? `
                        <ul>
                            ${event.items.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
            </div>
        `).join('');
    }

    function updateMonthTabs(year) {
        const monthTabsContainer = document.getElementById('monthTabs');
        monthTabsContainer.innerHTML = '';
        
        const months = tabsData[year];
        
        months.forEach((month, index) => {
            const button = document.createElement('button');
            button.className = 'month-tab active';
            button.dataset.month = month;
            
            // Asignar nombres legibles para las pesta√±as
            const tabNames = {
                'horario': 'HORARIO',
                'instalacion': 'INSTALACI√ìN',
                'sufragio': 'SUFRAGIO',
                'otros': 'OTROS'
            };
            
            button.textContent = tabNames[month];
            monthTabsContainer.appendChild(button);
            
            button.addEventListener('click', function() {
                document.querySelectorAll('.month-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                currentMonth = month;
                renderTimeline();
            });
        });
    }

    document.querySelectorAll('.year-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.year-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            currentYear = this.dataset.year;
            currentMonth = tabsData[currentYear][0];
            updateMonthTabs(currentYear);
            renderTimeline();
        });
    });

    // Inicializar
    updateMonthTabs(currentYear);
    renderTimeline();
</script>
{% endblock %}
